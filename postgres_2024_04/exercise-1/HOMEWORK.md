# SQL и реляционные СУБД. PostgreSQL в облаках 
### **1. Создал проект и виртуальная машина в платформе Яндекс.Облако**
![eca696f55141881e398340c21e8a2544.png](:/3b564e48c1314beeba97b00139b6346b)
### **2. В процессе создания ВМ дал имя начальному пользователю - otus и добавил публичный SSH-ключ, т.к. счел данный вариант более простым и быстрым (SSH-ключ ранее уже был сформирован)**
![5a021005ed373b1d4859ad6f2f074731.png](:/9f4f5d8c865342c889fdc888ee808bd4)
### **3. Вошел под описанными данными по SSH**
![abde3790bdd182aa56a3279ba428ce1c.png](:/d6852afc5810463186cf06dc59b4f5a5)
### **4. Установил Postgres с помощью скрипта из [документации](https://www.postgresql.org/download/linux/ubuntu/)**
![3c35cbd078f94e927099e536db6e9895.png](:/b1c551b1d8764fda9acfdbfc8918da48)
![cc625fa2b7b3d19dcf583e743dd8d7e9.png](:/ae238adf5e1f404c9aae18ace0d4e417)
###  5. Подключился через консоль psql и изменил параметр *listen_addresses* командой *ALTER SYSTEM SET*
![2e5c44d9776ce0485e62c77016d272c1.png](:/1a6c5bf8641745628eb433ddb22f2a7e)
![1dd70929016f5d8b60732d2e558f6739.png](:/bd8f01c7244b45b3a310049408886a0e)
Выбрал такой вариант, т.к. в видеоуроке объяснили, что лучше не менять параметр в конфиге, а писать внизу, но внизу написано, что нужно указывать параметры для расширений:
![bc18dc6da90cd4eaf2f8b7c908d70ca8.png](:/21046e17cb7740dfb22287de161fd59e)
***Прошу дать комментарий, насколько правильно так делать, т.к. наверняка есть обещепринятый стандарт.***
###  6. Добавил в */etc/postgresql/16/main/pg_hba.conf* необходимое значение и перезапустил кластер Postgres
![8ee97fe5c78558af83efd3b6355fad9a.png](:/f37d8f75c45e4bc28437862d971e592d)
###  7. Открыл две сессии *psql* и выключил в них *autocommit*
![4a06afdb8453769d27740c2f0d3be461.png](:/df85431daede417fb746b436910f603d)
###  8. Создал таблицу *persons* и заполнил ее данными в первой сессии
![40ee52a0f7594451536ff7a51796bd20.png](:/be8c533e239b44c088022db7bc07e14b)
###  9. Посмотрел текущий уровень изоляции
![652a31601a57b7725eb79527a5657b1b.png](:/5ed48adaae3c4d3fad3ffe24ccd557f1)
###  10. Добавил в первой сессии новую запись в таблицу, во второй выполил *SELECT*
![79af64b3ed5aab6b17b9e87462923259.png](:/fc1f5cf1ea3649688111de5cfb33036c)
Во второй не появилось записи, потому что для применения изменения необходимо выполнить COMMIT в первой сессии, чтобы зафиксировать изменения, либо пока мы ее либо не отменим командой ROLLBACK. В ином случае транзакция будет "висеть".
### 11. Выполнил команду *COMMIT* чтобы зафиксировать изменения
![e216e616831eb374b9cd40594c7bf5da.png](:/b4ed022dfc9940fa81ae8e8d7d638d0b)
Теперь во второй сессии есть изменения, магия :)
### 12. Завершил транзакцию во второй сессии командой *COMMIT*
### 13. Изменил уровень изоляции обеих сессий
![9efc7981e5d56f66a0dfc8623f519d0c.png](:/94dd62d77bb84d6191df51fadff11719)
### 14. Добавил в первой сессии новую запись и выполнил *SELECT* во второй
Изменений не вижу, т.к. по описанным ранее причинам не выполнен COMMIT в первой сессии
### 15. Выполнил *COMMIT* в первой сессии и выполнил еще раз *SELECT* во второй
![0bd5fba3a5926eff007e7186c9bfee81.png](:/4c71d883cbb34e8fb6671ee6a112e094)
Новой записи нет... Сначала не понял...
### 16. Выполнил *COMMIT* во второй сессии и выполнил еще раз *SELECT* в ней же
![9e54aa32f33e10eeed0aff2e303722fd.png](:/53223281ec334748bbceab1375577817)
Увидел изменения, а потом как понял :D
В уровне изоляции **repeatable read** необходимо завершить обе транзакции, чтобы увидеть обновленные данные во второй сессии.
